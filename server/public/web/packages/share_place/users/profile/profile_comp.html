<!-- https://github.com/CindyLinz/JS-Crop-Image -->
<div class="login" id="login" (keyup.esc)="cancel()">
  <div class="header">
    <div class="title">Profile</div>
    <div class="close" (click)="close()"></div>
    <form id="profileImageForm" #upload class="dragdrop_profil" [class.uploading]="uploading"
          (dragenter)="upload.style.setProperty('border', '2px solid #9FC8FA')"
          (drop)="upload.style.setProperty('border', '2px dotted #273B54');">
      <label id="labelfileuploadprf" for="filename">
        <!--?refreshHack=... obliges the browser to refresh the image if it changes-->
        <div class="spinAnim"><img src="/auth/gridfs/file/{{photoId}}"/>
          <div class="spinAnimCircle"></div>
        </div>
        <span class="spprof">Change</span>
      </label>
      <input type="file" id="filename" (change)="uploadFile()" class="uploadFile" name="avatar"
             style="opacity: 0"/>
    </form>
  </div>

  <div class="panels">
    <div class="error">{{error}}</div>
    <div class="messages">
      <div *ngFor="let message of messages">{{message}}</div>
    </div>

    <div class="local">
      <form action="#" method="post">
        <div class="email">
          <div class="label">Email</div>
          <material-input #email required type="email" label="example@domain.com" [disabled]="!emailChanging || isSocialAccount"
                          (change)="checkEmailChanged()" [(ngModel)]="connectedUser.mainMail"
                          class="mail iconM"></material-input>
          <div (click)="startEmailChange();email.focus();" class="changeMail" [class.hidden]="emailChanging || isSocialAccount"></div>
        </div>

        <div class="pass" [class.hidden]="!emailChanging">
          <div class="label">Password</div>
          <material-input [(ngModel)]="connectedUser.pass" type="password" class="password"></material-input>
        </div>

        <div class="changePass" (click)="passwordChanging = !passwordChanging"
             [class.hidden]="emailChanging || passwordChanging || isSocialAccount">Change
          password
        </div>

        <div class="passwordZone" [class.hidden]="emailChanging || !passwordChanging">
          <fieldset>
            <legend class="changePass" (click)="passwordChanging = !passwordChanging">Change password</legend>

            <div class="pass">
              <div class="label">Old Password</div>
              <material-input [(ngModel)]="connectedUser.pass" type="password" class="password"></material-input>
            </div>

            <div class="pass new" [class.hidden]="!passwordChanging">
              <div class="label">New Password</div>
              <material-input [(ngModel)]="newPass" type="password" class="password"></material-input>
            </div>
          </fieldset>
        </div>

        <div class="userName bottom_input">
          <div class="label">User name</div>
          <material-input required [(ngModel)]="connectedUser.name" class="name"></material-input>
        </div>
      </form>
    </div>
    <div class="social">
      <div class="line" [class.loggedIn]="linkedToFacebook" *ngIf="isWebApp">
        <div class="logLeft"><span class="log">{{hasFacebookAccount ? 'Logged in with' : 'Sign in'}} </span>
          <span class="nameConnected"> {{connectedUser?.facebookAccount?.firstName }} {{connectedUser?.facebookAccount?.lastName }}</span>
        </div>
        <a href="{{facebookUrl}}" class="socialBtn facebook">
          <span class="fa fa-facebook">  </span>
        </a>
      </div>
      <div class="line" [class.loggedIn]="linkedToFacebook" *ngIf="isWebApp">
        <div class="logLeft"><span class="log">{{hasGoogleAccount ? 'Logged in with' : 'Sign in'}} </span>
          <span class="nameConnected"> {{connectedUser?.googleAccount?.displayName  }}</span>
        </div>
        <a href="{{googleUrl}}" class="socialBtn google">
          <span class="fa fa-google"></span>
        </a>
      </div>
      <div class="skype bottom_input">
        <div class="label">Skype</div>
        <material-input [(ngModel)]="connectedUser.skype" class="value"></material-input>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="btnvalidat">
    <material-button raised class="btn_login" (click)="save()">Save</material-button>
  </div>
</div>