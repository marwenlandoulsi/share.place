<div class="files">
  <div *ngIf="selectedFile != null" class="content">


    <div class="title">File
      <div class="icons"></div>
    </div>
    <div *ngIf="isUploading" class="isUploading">
      <div class="progress"></div>
    </div>

    <div class="newTopic">
      <div class="newComment newTopicBlock">
        <img src="/auth/user/photo/s/{{connectedUser.id}}" class="profileImg">
        <input #comment class="comment"
               (keyup.enter)="addComment(comment.value, selectedFile.versions.last.v);comment.value='';"
               class="txt"/>

        <div (click)="addComment(comment.value, selectedFile.versions.last.v);comment.value='';"
             class="btn_valid"></div>

        <postit-comp [name]="'comment'" [body]="'To talk to the team, type a comment here...'"
                     class="commentPostit"></postit-comp>
      </div>
    </div>

    <ul class="list">
      <li class="file">
        <div class="fileDesc">
          <div class="latestVersionComments">
            <div class="versions">
              <ul>
                <li *ngFor="let versionItem of selectedFile.orderedVersions; let versionIndex = index"
                    class="version_part_li">

                  <div class="versionTitle">
                    <div class="versionTitleNumber">Version {{versionItem?.v}}</div>
                    <div class="toggleVersion fa"
                         [ngClass]="{'fa-angle-down': isCommentsOpen(selectedFile.id, versionItem.v), 'fa-angle-up': !isCommentsOpen(selectedFile.id, versionItem.v)}"
                         (click)="switchCommentOpen(selectedFile.id, versionItem.v)"></div>
                  </div>

                  <div class="version">
                    <div *ngIf="isCommentsOpen(selectedFile.id, versionItem.v)" class="versionComments"
                         [class.activep]="isCommentsOpen(selectedFile.id, versionItem.v)">
                      <ul class="actionList">
                        <li *ngFor="let actionItem of getActionsForVersion(versionItem)" class="actionLiElem"
                            [class.ownAction]="isActionAuthor( actionItem )"
                            [class.isActionOn]="isActionOn( actionItem )">
                          <div *ngIf="actionItem.action.actionType == 'comment'" class="actionBlock commentBlock">

                            <div class="actionPropsBlock">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{versionItem?.ts | agoDateFormat}}</span>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent"> {{actionItem.text}}</div>
                            </div>
                          </div>

                          <div *ngIf="actionItem.action.actionType == 'fileApprove'"
                               class="actionBlock lockBlock approveBlock">

                            <div class="actionPropsBlock">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{versionItem?.ts | agoDateFormat}}</span>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent">
                                <span class="constructText">{{constructText(versionItem, actionItem)}}
                                </span>
                                <div class="approveIcon bgWhite"></div>
                              </div>
                            </div>
                          </div>

                          <div *ngIf="actionItem.action.actionType == 'fileLock'" class="actionBlock lockBlock">
                            <div class="actionPropsBlock">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{versionItem?.ts | agoDateFormat}}</span>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent">
                                <span class="constructText">{{constructText(versionItem, actionItem)}}</span>
                                <material-button *ngIf="selectedFile.isLocked && isActionAuthor( actionItem ) && isActionOn( actionItem ) && versionIndex == 0" class="release" (click)="unlock()">
                                  Release
                                </material-button>
                                <div class="lockIcon"></div>
                              </div>

                            </div>
                          </div>

                        </li>
                        <li class="actionLiElem" [class.ownAction]="connectedUser.id == versionItem.userId">
                          <div class="actionBlock {{versionItem.approved == null ? 'draft' : 'approved'}}">
                            <div class="actionPropsBlock">
                              <span class="author"><img src="/auth/user/photo/s/{{versionItem.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{versionItem?.ts | agoDateFormat}}</span>
                            </div>

                            <div class="bubble">
                              <!---->
                              <div class="bubbleContent">
                                <div class="pLeft" (click)="openFileDialog()">
                                  <div class="fileThumb">
                                    <div class="fileThumb_bg">
                                      <img
                                          src="/sp/place/{{selectedPlace?.id}}/folder/{{selectedFolder?.id}}/file/{{selectedFile?.id}}/version/{{versionItem.v}}/thumb"
                                          class="thumbnail">
                                      <div class="uploadStatus" *ngIf="versionItem.status!='uploaded'"><img
                                          src="../images/uploading.png"/></div>
                                    </div>
                                  </div>
                                  <div class="rightDetails">
                                    <!--version +actions more>-->
                                    <div class="fileProps">
                                      <div class="line">
                                        <div class="fileLink">
                                          <div class="fileName">{{selectedFile?.name}}</div>
                                        </div>
                                        <div class="linerow">
                                          <span class="filetypedoc">{{formatDesc( versionItem )}}</span>
                                          <span class="fileSize">
                                            {{selectedFile.orderedVersions[0].size | fileSizeFormat}}
                                          </span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <div class="fileMoreActions">
                                  <span class="fileversion">v. {{versionItem.v}}</span>
                                  <span class="moreActions" popupSource
                                        #fileMenu="popupSource"
                                        (click)="switchMenuState(versionItem.v)"></span>
                                </div>

                              </div>
                            </div>
                          </div>

                          <material-popup class="popVersion" defaultPopupSizeProvider
                                          enforceSpaceConstraints
                                          [source]="fileMenu"
                                          [visible]="fileMenuVisible == versionItem.v"
                          >
                            <div header class="">
                              <div class="fileName">{{selectedFile.name}}</div>
                              <div class="fileInfo">
                                Version {{versionItem.v}} {{versionItem.ts | agoDateFormat}}
                              </div>
                            </div>
                            <div class="popupContent">
                              <div group>
                                <material-button (click)="approve(versionItem)" *ngIf="versionItem.approved == null"
                                                 class="menuItem">
                                  Approve
                                </material-button>
                                <material-button (click)="unapprove(versionItem)" *ngIf="versionItem.approved != null"
                                                 class="menuItem">
                                  Unapprove
                                </material-button>
                                <material-button *ngIf="!selectedFile.isLocked" (click)="lock()" class="menuItem">
                                  Lock
                                </material-button>
                                <material-button *ngIf="selectedFile.isLocked" (click)="unlock()" class="menuItem">
                                  Unlock
                                </material-button>
                              </div>
                              <material-button (click)="delete()" class="menuItem">
                                Delete
                              </material-button>
                            </div>
                          </material-popup>
                        </li>
                      </ul>
                    </div>
                  </div>


                  <modal *ngIf="openFile" [visible]="openFile">
                    <material-dialog class="basic-dialog fileOpen" hideHeader="true" hideFooter="true">
                      <div class="popupHeader">
                        <div class="fileName">{{selectedFile.name}}</div>
                        <div class="close" (click)="cancelFileOpen()"></div>
                      </div>
                      <div class="content">
                        <div class="explanation">Do you want to lock and modify or just take a look at the document?
                        </div>
                        <div class="fileActions">
                          <div class="fileActions_btn">
                            <div class="btn material-icons lock" (click)="lockAndOpen(versionItem.v)"><span>Lock & Modify</span>
                            </div>
                          </div>
                          <div class="fileActions_btn posRight">
                            <div class="btn material-icons openOnly" (click)="openFileLink(versionItem.v)">
                              <span>View (read only)</span></div>
                          </div>
                        </div>
                      </div>
                    </material-dialog>
                  </modal>


                </li>
              </ul>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>