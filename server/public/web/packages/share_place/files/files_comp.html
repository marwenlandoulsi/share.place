<div class="files">
  <div *ngIf="selectedFile != null" class="content">

    <div class="title">File
      <div class="icons"></div>
    </div>


    <div class="newTopic">
      <div class="newComment newTopicBlock">
        <img src="/auth/user/photo/s/{{connectedUser.id}}" class="profileImg">
        <div class="arowmenow"><input #comment class="comment" placeholder="Write your comment here"
                                      (keyup.enter)="addComment(comment.value, selectedFile.versions.last.v);comment.value='';"
                                      class="txt"/>

          <div (click)="addComment(comment.value, selectedFile.versions.last.v);comment.value='';"
               class="btn_valid"></div>
        </div>

        <postit-comp [name]="'comment'" [body]="'To talk to the team, type a comment here...'"
                     class="commentPostit"></postit-comp>
      </div>
    </div>

    <ul class="list">
      <li class="file">
        <div class="fileDesc">
          <div class="latestVersionComments">
            <div class="versions">
              <ul>
                <li *ngFor="let versionItem of selectedFile.orderedVersions; let versionIndex = index"
                    class="liVersion">

                  <div class="versionTitle">
                    <div class="versionTitleNumber">Version {{versionItem?.v}}</div>
                    <div class="toggleVersion fa"
                         [ngClass]="{'fa-angle-down': isCommentsOpen(selectedFile.id, versionItem.v), 'fa-angle-up': !isCommentsOpen(selectedFile.id, versionItem.v)}"
                         (click)="switchCommentOpen(selectedFile.id, versionItem.v)"></div>
                  </div>

                  <div class="version">
                    <div *ngIf="isCommentsOpen(selectedFile.id, versionItem.v)" class="versionComments">
                      <ul class="actionList">
                        <li *ngFor="let actionItem of getActionsForVersion(versionItem); let actionIndex = index"
                            class="actionLiElem"
                            [class.ownAction]="isActionAuthor( actionItem )"
                            [class.isActionOn]="isActionOn( actionItem )">

                          <!--comment-->
                          <div *ngIf="actionItem.action.actionType == 'comment'" class="actionBlock commentBlock">

                            <div (click)="showUserInfoPopup( versionItem, actionIndex )" class="actionPropsBlock"
                                 popupSource alignPositionX="before"
                                 alignPositionY="start" #commentAuthor="popupSource">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{actionItem?.ts | agoDateFormat}}</span>
                              <info-popup *ngIf="isUserInfoPopup(versionItem, actionIndex)" [userId]="popupUserInfoId"
                                          [source]="commentAuthor" [parent]="self" [offsetY]="-10"
                                          [arrowCss]="'arrowRight'"></info-popup>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent"> {{actionItem.text}}</div>
                            </div>
                          </div>
                          <!--fileApprove-->
                          <div *ngIf="actionItem.action.actionType == 'fileApprove'"
                               class="actionBlock etatBlock approveBlock">

                            <div (click)="showUserInfoPopup( versionItem, actionIndex )" class="actionPropsBlock"
                                 popupSource alignPositionX="before"
                                 alignPositionY="start" #approveAuthor="popupSource">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{actionItem?.ts | agoDateFormat}}</span>
                              <info-popup *ngIf="isUserInfoPopup(versionItem, actionIndex)" [userId]="popupUserInfoId"
                                          [offsetY]="-10" [source]="approveAuthor" [parent]="self"
                                          [arrowCss]="'arrowRight'"></info-popup>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent">
                                <span class="constructText">{{constructText(versionItem, actionItem)}}
                                </span>
                                <div class="approveIcon bgWhite"></div>
                              </div>
                            </div>
                          </div>


                          <!--fileLock-->
                          <div *ngIf="actionItem.action.actionType == 'fileLock'"
                               class="actionBlock etatBlock lockBlock">
                            <div (click)="showUserInfoPopup( versionItem, actionIndex )" class="actionPropsBlock"
                                 popupSource alignPositionX="before"
                                 alignPositionY="start" #lockAuthor="popupSource">
                              <span class="author"><img src="/auth/user/photo/s/{{actionItem.user.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{actionItem?.ts| agoDateFormat}}</span>
                              <info-popup *ngIf="isUserInfoPopup(versionItem, actionIndex)" [userId]="popupUserInfoId"
                                          [offsetY]="-10" [source]="lockAuthor" [parent]="self"
                                          [arrowCss]="'arrowRight'"></info-popup>
                            </div>

                            <div class="bubble">
                              <div class="bubbleContent">
                                <material-button
                                    *ngIf="showReleaseButton(actionItem, actionIndex, versionIndex)"
                                    class="release" (click)="unlock()">
                                  Release
                                </material-button>
                                <span class="constructText">{{constructText(versionItem, actionItem)}}</span>
                                <div class="lockIcon"></div>
                              </div>

                            </div>

                          </div>


                        </li>
                        <!--connectedUser-->
                        <li class="actionLiElem" [class.ownAction]="connectedUser.id == versionItem.userId">
                          <div class="actionBlock {{versionItem.approved == null ? 'draft' : 'approved'}}">
                            <div class="actionPropsBlock" (click)="showUserInfoPopup( versionItem, -1 )" popupSource
                                 alignPositionX="before"
                                 alignPositionY="start" #fileAuthor="popupSource">
                              <span class="author"><img src="/auth/user/photo/s/{{versionItem.userId}}"
                                                        class="profileImg"></span>
                              <span class="comm-ts">{{versionItem?.ts | agoDateFormat}}</span>
                              <info-popup *ngIf="isUserInfoPopup(versionItem, -1)" [userId]="popupUserInfoId"
                                          [offsetY]="-10" [source]="fileAuthor" [parent]="self"
                                          [arrowCss]="'arrowRight'"></info-popup>
                            </div>

                            <div class="bubble">

                              <div class="bubbleContent">
                                <div class="pLeft" [class.noClick]="!isFile" (click)="openFileDialog(versionItem.v)">
                                  <div class="fileThumb">
                                    <div class="fileThumb_bg">
                                      <img
                                          src="/sp/place/{{selectedPlace?.id}}/folder/{{selectedFolder?.id}}/file/{{selectedFile?.id}}/version/{{versionItem.v}}/thumb"
                                          class="thumbnail">
                                      <div
                                          *ngIf="versionItem.status!='uploaded' && versionItem?.mimeType != 'application/quickNote'"
                                          class="uploadStatus">
                                        <img
                                            src="../images/uploading.png"/></div>
                                    </div>
                                  </div>
                                  <div class="rightDetails">
                                    <!--version +actions more>-->
                                    <div class="fileProps">
                                      <div class="line">
                                        <div class="fileLink">
                                          <div class="fileName">{{selectedFile?.name}}</div>
                                        </div>
                                        <div class="linerow" *ngIf="versionItem?.mimeType != 'application/quickNote'">
                                          <span class="filetypedoc">{{formatDesc( versionItem )}}</span>
                                          <span class="fileSize">
                                            {{selectedFile.orderedVersions[0].size | fileSizeFormat}}
                                          </span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <div class="fileMoreActions">
                                  <span class="fileversion">v. {{versionItem.v}}</span>
                                  <span class="moreActions" popupSource
                                        #fileMenu="popupSource"
                                        (click)="switchMenuState(versionItem.v)"></span>
                                </div>

                              </div>

                            </div>
                          </div>

                          <material-popup class="popVersion " defaultPopupSizeProvider
                                          enforceSpaceConstraints
                                          [source]="fileMenu"
                                          [visible]="fileMenuVisible == versionItem.v">
                            <div header class="headerPopVersion">
                              <div class="fileName">{{selectedFile.name}}</div>
                              <div class="fileInfo">
                                Version {{versionItem.v}}, {{versionItem.ts | agoDateFormat}}
                              </div>
                            </div>
                            <div class="popupContent popinVersion">
                              <div group>
                                <material-button (click)="approve(versionItem)"
                                                 *ngIf="versionItem.approved == null && isOwner"
                                                 class="menuItemVers">
                                  <span class="spanVers"> <i class="zmdi zmdi-check-circle approve"></i> </span> Approve
                                </material-button>
                                <material-button (click)="unapprove(versionItem)"
                                                 *ngIf="versionItem.approved != null && isOwner && connectedUser.id == versionItem?.approved?.userId"
                                                 class="menuItemVers">
                                  <span class="spanVers"><i class="zmdi zmdi-check-circle nnApprove"></i> </span>
                                  Unapprove
                                </material-button>
                                <!--<material-button *ngIf="!selectedFile.isLocked" (click)="lock()" class="menuItemVers">-->
                                <!--Lock-->
                                <!--</material-button>-->
                                <!--<material-button *ngIf="selectedFile.isLocked" (click)="unlock()" class="menuItemVers">-->
                                <!--Unlock-->
                                <!--</material-button>-->
                              </div>
                              <material-button class="menuItemVers" *ngIf="false">
                                <span class="spanVers"><i class="zmdi zmdi-comment commentVers"></i> </span>Comment

                              </material-button>
                              <material-button (click)="delete()" class="menuItemVers" *ngIf="false">
                                <span class="spanVers"><i class="zmdi zmdi-delete delete"></i> </span> Delete
                              </material-button>
                            </div>
                          </material-popup>
                        </li>
                      </ul>
                    </div>
                  </div>


                  <modal *ngIf="openFileVersion != -1" [visible]="openFileVersion != -1">
                    <material-dialog class="basic-dialog fileOpen" hideHeader="true" hideFooter="true">
                      <div class="popupHeader">
                        <div class="fileName">{{selectedFile.name}}</div>
                        <div class="close" (click)="cancelFileOpen()"></div>
                      </div>
                      <div class="content">
                        <div class="explanation">Do you want to lock and modify or just take a look at the document?
                        </div>
                        <div class="fileActions">
                          <div class="fileActions_btn">
                            <div class="btn material-icons lock" (click)="lockAndOpen(openFileVersion)"><span>Lock & Modify</span>
                            </div>
                          </div>
                          <div class="fileActions_btn posRight">
                            <div class="btn material-icons openOnly" (click)="openFileLink(openFileVersion)">
                              <span>View (read only)</span></div>
                          </div>
                        </div>
                      </div>
                    </material-dialog>
                  </modal>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </li>
    </ul>


    <div *ngIf="isUploading" class="isUploading">
      <div class="progress"></div>
    </div>

  </div>
</div>