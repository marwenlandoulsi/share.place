<div *ngIf="selectedFolder != null" class="subjects {{dropFileFormVisible ? 'dropZoneVisible' : 'hideDropZone'}}">

  <div #dropZone class="dropZone">
    <div class="headerSubject">
      <span class="nameTroq titleSubject" title="{{selectedFolder.name}}"
            [innerHTML]="selectedFolder?.name  | wrapBold: searchText"></span>

      <modal [visible]="adding">
        <material-dialog defaultPopupSizeProvider
                         enforceSpaceConstraints
                         class="profilemenuvisible">
          <invite-users-dialog></invite-users-dialog>
        </material-dialog>
      </modal>

      <div class="rightSubjTitle">
        <!-- emplacement des users  -->

        <ul class="users_list">
          <div style="background-color: red" (click)="showPopupUserList()" *ngIf="hiddenUserNbre > 0">
            <div popupSource alignPositionX="end" class="computeUsers"
                 alignPositionY="after" #userListPopup="popupSource"> +{{hiddenUserNbre}}
            </div>
            <userList-Popup [source]="userListPopup" [offsetX]="7" [offsetY]="0"
                            [arrowCss]="'arrowTop'"></userList-Popup>
          </div>
          <li *ngFor="let userItem of usersToShow" popupSource #userInfoPopup="popupSource" alignPositionX="end"
              alignPositionY="after" class="useractive" [class.approver]="isOwner(userItem)"
              (click)="userInfoRequested=userItem">
            <img src="{{userProfilePic(userItem.id)}}">
            <info-popup *ngIf="infoPopupUser?.id == userItem.id" [(visible)]="infoPopupOpen"
                        [source]="userInfoPopup"
                        [offsetX]="7" [offsetY]="0"
                        [userId]="userItem.id" [parent]="self" [allowUserRemoval]="true"
                        [user]="userItem"
                        [arrowCss]="'arrowTop'"></info-popup>
          </li>
        </ul>
        <div (click)="add()" class="addBtn addPeople" id="btnAddPeople"></div>
      </div>
    </div>
    <div class="newTopic">
      <div class="newTopicBlock">
        <input id="addTopic" type="text" #text (keyup)="note=text.value" (keyup.enter)="createQuickNote(false)"
               placeholder="Start a topic..."
               class="txt" value="{{note}}"/>
        <div (click)="createQuickNote(false)" class="btn_valid"></div>
      </div>
      <div class="addTopicBtn" (click)="fileInput.click()"></div>
    </div>
    <div class="zoneDragingIn">
      <div class="subjectListScollZone" (dragenter)="dragEnter(dropZone)">
        <div class="scrollbar-macosx">
          <div class="spinnerInner" *ngIf="subjects == null">
            <material-spinner class="spinner"></material-spinner>
          </div>

          <!--<postit-comp  [name]="'places'" [header]=welcomePostit-->
          <!--[body]=visiblePostits-->
          <!--class="placesPostit"></postit-comp>-->


          <ul id="subjectList" #subjectList class="subjectList">

            <li *ngFor="let subject of subjects; let subjectIndex = index" (click)="gotoSubject(subject)"
                class="subjectItem"
                [class.qNote]="subject.dataType == 'quickNote'"
                [class.selected]="selectedSubject != null && subject.id == selectedSubject.id"
                [class.approved]="subject.approved != null"
                [class.locked]="subject.lockOwner != null"
                [class.ownAction]="subject.lockOwner?.userId == connectedUser.id"
                [class.unread]="wasRead(subject)"
                id="{{constructSubjectDivId(subject)}}">

              <div *ngIf="renaming == null || renaming?.id != subject?.id" class="subject"
                   (dragstart)="$event.dataTransfer.setData('subjectId', subject.id);" draggable="true">
                <div class="thumb">
                  <div *ngIf="subject.status == 'waiting'" class="spinnerInner">
                    <material-spinner class="spinner"></material-spinner>
                  </div>
                  <div *ngIf="subject.status == 'definitelyLost'" class="crashedInner"></div>
                  <img *ngIf="subject.status != 'waiting'"
                       src="{{thumbSrc(subject,selectedFolder)}}">
                </div>
                <div *ngIf="subject.mimeType != 'application/quickNote'" class="version"> V.{{subject.v}}</div>
                <div class="name" title="{{subject.name}}" [innerHTML]="subject?.name  | wrapBold: searchText">
                  <!--{{subject.name}}-->
                </div>
                <div class="subjectRight">

                  <div (click)="rename(subject)" class="rename_subject"
                       *ngIf="(subject.dataType == 'quickNote' || subject.dataType == 'file') && (connectedUserIsOwner || isWriter) "></div>
                  <div (click)="removeSubject(subject, $event)" class="delete_subject"
                       *ngIf="(subject.dataType == 'quickNote' || subject.dataType == 'file') && (connectedUserIsOwner || isWriter)"></div>

                  <div class="users">
                    <ul>
                      <!-- lastThreeUsers(subject) -->
                      <li *ngFor="let activeUser of subject.users" class="user">
                        <div class="profileImg" [class.validator]="activeUser.role == 'admin'"
                             (click)="showSubjectUserInfoPopup( activeUser.userId, subjectIndex, $event )"
                             popupSource alignPositionX="end"
                             alignPositionY="after" #subjectParticipant="popupSource">
                          <img *ngIf="activeUser.photoId != null && activeUser.type == null"
                               src="/auth/gridfs/file/{{activeUser.photoId}}/picture.x"
                               class="profileImg">
                          <img *ngIf="activeUser.photoId == null && activeUser.type == null"
                               src="/images/img_profile.png"
                               class="profileImg">
                          <img *ngIf=" activeUser.type == 'roby'" src="/images/roby.png">
                        </div>
                        <info-popup
                            *ngIf="subjectIndex == subjectInfoPopupIndex && popupUserInfoId == activeUser.userId"
                            [userId]="activeUser.userId"
                            [source]="subjectParticipant" [offsetX]="11" [offsetY]="10"
                            [visible]="popupUserInfoId == activeUser.userId" [parent]="self"
                            [arrowCss]="'arrowTop'"></info-popup>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                </div>
              </div>
              <div class="subject">
                <!--  <input *ngIf="renaming != null || renaming?.id == subject?.id" type="text" #folderRenamer
                         value="{{subject.name}}"
                         (keydown.enter)="doRename(folderRenamer.value)" autofocus/>
                  &lt;!&ndash;<btn [sources]="['../../images/ok_white.png', '../../images/ok_white.png', '../../images/ok_white.png']"&ndash;&gt;

  <btn [sources]="['../../images/ok_white.png', '../../images/ok_white.png', '../../images/ok_white.png']"
       (click)="doRename(folderRenamer.value)"></btn>-->

                <div *ngIf="isRenaming(subject)" class="editSubject">
                  <input type="text" #folderRenamer autoFocus="true"
                         value="{{subject.name}}" (keyup.enter)="doRename(folderRenamer.value)"/>
                  <btn [sources]="['/images/okBlue.png', '/images/okBlue.png', '/images/okBlue.png']"
                       (click)="doRename(folderRenamer.value)"></btn>
                </div>
              </div>
              <div class="clearfix"></div>
            </li>
          </ul>
        </div>
      </div>


      <form #fileForm id="fileForm" class="uploadDropZone" (dragenter)="dragEnter(dropZone)"
            (dragleave)="dragLeave(dropZone)"
            (drop)="fileDropped(dropZone)">

        <label #fileUploadLabel id="labelfileupload" for="fileupload"> Drag'n drop or browse file </label>
        <input #fileInput type="file" id="fileupload"
               (change)="uploadFiles($event.target.files, fileForm)"
               class="uploadFile" name="toUpload"
               style="opacity: 0;"
               (click)="openFileDialogConditionally($event, fileUploadLabel)" multiple/>
        <!--<postit-comp [name]="'files'" [header]="'Cool !'"-->
        <!--[body]="'Now you can Drag\'n drop a file here and start collaborate with your team '"-->
        <!--class="filesPostit"></postit-comp>-->

      </form>
    </div>


    <!--<postit-comp [name]="'invitePeople'" [header]="'Great!'"-->
    <!--[body]="'Now invite some poople to join you clicking on the + icon'"-->
    <!--class="subjectsPostit"></postit-comp>-->

    <!--<postit-comp  *ngIf="selectedSubject != null" [name]="'welcomePostit'" [header]="'Cool :) '"-->
    <!--[body]="'Now we are sharing this welcome document. Click on it, edit and release the doc. All the team will be updated in real time.'"-->
    <!--class="welcomePostit"></postit-comp>-->

  </div>


  <modal *ngIf="showConfirmDialog" [visible]="showConfirmDialog">
    <material-dialog class="basic-dialog fileOpen" hideHeader="true"
                     hideFooter="true">
      <div class="popupHeader">
        <div class="fileName">
          Open Or create Note
        </div>
        <div class="close" (click)="showConfirmDialog = false"></div>
      </div>
      <div class="content">
        <div class="explanation">
          {{textConfirmDialog}}
        </div>
        <div class="fileActions">
          <table width="100%" style="margin-top: 1em;">
            <tr>
              <td width="45%">
                <div class="fileActions_btn">
                  <div class="btn material-icons newCopy"
                       (click)="createQuickNote(true)"></div>
                  <span>Create new</span>
                </div>
              </td>
              <td width="10%"></td>
              <td width="45%">
                <div class="fileActions_btn">
                  <div class="btn material-icons goTo"
                       (click)="viewSameNote(conflictingId)"></div>
                  <span>Go to note</span>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </material-dialog>
  </modal>
</div>




